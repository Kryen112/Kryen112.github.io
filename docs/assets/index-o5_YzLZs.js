var Xt=Object.defineProperty;var Ht=a=>{throw TypeError(a)};var te=(a,t,e)=>t in a?Xt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var u=(a,t,e)=>te(a,typeof t!="symbol"?t+"":t,e),Ft=(a,t,e)=>t.has(a)||Ht("Cannot "+e);var n=(a,t,e)=>(Ft(a,t,"read from private field"),e?e.call(a):t.get(a)),h=(a,t,e)=>t.has(a)?Ht("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),r=(a,t,e,s)=>(Ft(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e),N=(a,t,e)=>(Ft(a,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var ee=Object.defineProperty,se=(a,t)=>{for(var e in t)ee(a,e,{get:t[e],enumerable:!0,configurable:!0,set:s=>t[e]=()=>s})},ie={};se(ie,{slotTypes:()=>Et,permissions:()=>ne,itemsHandlingFlags:()=>Nt,itemClassifications:()=>x,clientStatuses:()=>Ut});var Ut={disconnected:0,connected:5,ready:10,playing:20,goal:30},x={progression:1,useful:2,trap:4,none:0},Nt={minimal:0,others:1,own:2,starting:4,all:7},ne={disabled:0,enabled:1,goal:2,auto:6,autoEnabled:7},Et={spectator:0,player:1,group:2};class Y extends Error{}class oe extends Error{constructor(e,s,i){super(e);u(this,"argumentName");u(this,"value");this.argumentName=s,this.value=structuredClone(i)}}class ae extends Error{constructor(e,s){super(e);u(this,"errors",[]);this.errors=s}}class R extends Error{}var jt={timeout:1e4,autoFetchDataPackage:!0,maximumMessages:1e3,debugLogVersions:!0},re={major:0,minor:5,build:1},he="2.0.4";function qt(){const a=[];for(let t=0;t<36;t++)a.push(Math.floor(Math.random()*16));return a[14]=4,a[19]=a[19]&=-5,a[19]=a[19]|=8,a[8]=a[13]=a[18]=a[23]="-",a.map(t=>t.toString(16)).join("")}var At={password:"",uuid:qt(),tags:[],version:re,items:Nt.all,slotData:!0},Z,M,lt,dt;class J{constructor(t,e,s,i){h(this,Z);h(this,M);h(this,lt);h(this,dt);r(this,Z,t),r(this,M,e),r(this,lt,s),r(this,dt,i)}toString(){return this.name}get receiver(){return n(this,dt)}get sender(){return n(this,lt)}get name(){return n(this,Z).package.lookupItemName(this.game,n(this,M).item,!0)}get id(){return n(this,M).item}get locationName(){return n(this,Z).package.lookupLocationName(this.sender.game,n(this,M).location,!0)}get locationId(){return n(this,M).location}get locationGame(){return this.sender.game}get game(){return this.receiver.game}get progression(){return(this.flags&x.progression)===x.progression}get useful(){return(this.flags&x.useful)===x.useful}get trap(){return(this.flags&x.trap)===x.trap}get filler(){return this.flags===x.none}get flags(){return n(this,M).flags}}Z=new WeakMap,M=new WeakMap,lt=new WeakMap,dt=new WeakMap;class $t{constructor(t,e){u(this,"game");u(this,"checksum");u(this,"itemTable");u(this,"locationTable");u(this,"reverseItemTable");u(this,"reverseLocationTable");this.game=t,this.checksum=e.checksum,this.itemTable=Object.freeze(e.item_name_to_id),this.locationTable=Object.freeze(e.location_name_to_id),this.reverseItemTable=Object.freeze(Object.fromEntries(Object.entries(this.itemTable).map(([s,i])=>[i,s]))),this.reverseLocationTable=Object.freeze(Object.fromEntries(Object.entries(this.locationTable).map(([s,i])=>[i,s])))}exportPackage(){return{checksum:this.checksum,item_name_to_id:{...this.itemTable},location_name_to_id:{...this.locationTable}}}}var Q,T,q,z,Pt,Gt;class ce{constructor(t){h(this,Pt);h(this,Q);h(this,T,new Map);h(this,q,new Map);h(this,z,new Set);r(this,Q,t),n(this,Q).socket.on("roomInfo",e=>{n(this,T).clear(),n(this,q).clear(),n(this,z).clear(),n(this,T).set("Archipelago",N(this,Pt,Gt).call(this));for(const s in e.datapackage_checksums)n(this,q).set(s,e.datapackage_checksums[s]),n(this,z).add(s)})}findPackage(t){return n(this,T).get(t)??null}async fetchPackage(t=[],e=!0){t.length===0&&(t=Array.from(n(this,z))),t=t.filter(i=>{var o;return n(this,z).has(i)?((o=n(this,T).get(i))==null?void 0:o.checksum)!==n(this,q).get(i):!1});const s={games:{}};for(const i of t){const o={cmd:"GetDataPackage",games:[i]},[c]=await n(this,Q).socket.send(o).wait("dataPackage");s.games[i]=c.data.games[i]}return e&&this.importPackage(s),s}importPackage(t){for(const e in t.games)n(this,T).set(e,new $t(e,t.games[e])),n(this,q).set(e,t.games[e].checksum)}exportPackage(){return{games:n(this,T).entries().reduce((t,[e,s])=>(t[e]=s.exportPackage(),t),{})}}lookupItemName(t,e,s=!0){const i=`Unknown Item ${e}`,o=this.findPackage(t);if(!o)return s?i:void 0;const c=o.reverseItemTable[e];return s&&c===void 0?i:c}lookupLocationName(t,e,s=!0){const i=`Unknown Location ${e}`,o=this.findPackage(t);if(!o)return s?i:void 0;const c=o.reverseLocationTable[e];return s&&c===void 0?i:c}}Q=new WeakMap,T=new WeakMap,q=new WeakMap,z=new WeakMap,Pt=new WeakSet,Gt=function(){return new $t("Archipelago",{checksum:"ac9141e9ad0318df2fa27da5f20c50a842afeecb",item_name_to_id:{Nothing:-1},location_name_to_id:{"Cheat Console":-1,Server:-2}})};var X,_,ut,mt;class le{constructor(t,e,s){h(this,X);h(this,_,[]);h(this,ut);h(this,mt);r(this,X,t),r(this,ut,e),r(this,mt,s)}replace(t){return n(this,_).push({operation:"replace",value:t}),this}default(){return n(this,_).push({operation:"default",value:null}),this}add(t){return n(this,_).push({operation:"add",value:t}),this}multiply(t){return n(this,_).push({operation:"mul",value:t}),this}power(t){return n(this,_).push({operation:"pow",value:t}),this}remainder(t){return n(this,_).push({operation:"mod",value:t}),this}floor(){return n(this,_).push({operation:"floor",value:null}),this}ceiling(){return n(this,_).push({operation:"ceil",value:null}),this}max(t){return n(this,_).push({operation:"max",value:t}),this}min(t){return n(this,_).push({operation:"min",value:t}),this}and(t){return n(this,_).push({operation:"and",value:t}),this}or(t){return n(this,_).push({operation:"or",value:t}),this}xor(t){return n(this,_).push({operation:"xor",value:t}),this}leftShift(t){return n(this,_).push({operation:"left_shift",value:t}),this}rightShift(t){return n(this,_).push({operation:"right_shift",value:t}),this}remove(t){return n(this,_).push({operation:"remove",value:t}),this}pop(t){return n(this,_).push({operation:"pop",value:t}),this}update(t){return n(this,_).push({operation:"update",value:t}),this}async commit(t=!1){const e=qt(),s={cmd:"Set",default:n(this,mt),key:n(this,ut),operations:n(this,_),want_reply:t,uuid:e};if(n(this,X).socket.send(s),!t)return;const[i]=await n(this,X).socket.wait("setReply",o=>o.uuid===e);return i.value}}X=new WeakMap,_=new WeakMap,ut=new WeakMap,mt=new WeakMap;var C,L,H,Ot,Kt;class de{constructor(t){h(this,Ot);h(this,C);h(this,L,{});h(this,H,{});r(this,C,t),n(this,C).socket.on("disconnected",()=>{r(this,L,{}),r(this,H,{})}).on("setReply",e=>{n(this,L)[e.key]=e.value;const s=n(this,H)[e.key];s&&s.forEach(i=>i(e.key,e.value,e.original_value))}).on("connected",()=>{if(n(this,C).options.debugLogVersions){const e=`${n(this,C).game}:${he}:${navigator==null?void 0:navigator.userAgent}`;this.prepare("archipelago.js__runtimes",{}).default().update({[e]:!0}).commit(!1)}})}get store(){return structuredClone(n(this,L))}async fetch(t,e=!1){let s=typeof t=="string"?[t]:t;if(e){const o=s.filter(c=>n(this,L)[c]===void 0);o.length>0&&n(this,C).socket.send({cmd:"SetNotify",keys:o})}let i={};if(s=s.filter(o=>{const c=structuredClone(n(this,L)[o]),l=c!==void 0;return l&&(i[o]=c),!l}),s.length>0){const o=await N(this,Ot,Kt).call(this,s);i={...i,...o}}return e&&r(this,L,{...n(this,L),...i}),typeof t=="string"?i[t]:i}async notify(t,e){return t.forEach(s=>{var i;(i=n(this,H))[s]??(i[s]=[]),n(this,H)[s].push(e)}),this.fetch(t,!0)}prepare(t,e){if(t.startsWith("_read_"))throw TypeError("Cannot manipulate read only keys.");return new le(n(this,C),t,e)}async fetchItemNameGroups(t){return await this.fetch([`_read_item_name_groups_${t}`],!0)}async fetchLocationNameGroups(t){return await this.fetch([`_read_location_name_groups_${t}`],!0)}}C=new WeakMap,L=new WeakMap,H=new WeakMap,Ot=new WeakSet,Kt=async function(t){const e=qt(),[s]=await n(this,C).socket.send({cmd:"Get",keys:t,uuid:e}).wait("retrieved",i=>i.uuid===e);return s.keys};var B;class ue{constructor(){h(this,B,{})}addEventListener(t,e,s=!1){var i;(i=n(this,B))[t]??(i[t]=[]),n(this,B)[t].push([e,s])}removeEventListener(t,e){const s=n(this,B)[t];s&&s.length>0&&(n(this,B)[t]=s.filter(([i])=>i!==e))}dispatchEvent(t,e){const s=n(this,B)[t]??[];for(const[i,o]of s)i(...e),o&&this.removeEventListener(t,i)}}B=new WeakMap;var D;class ct{constructor(){h(this,D,new ue)}on(t,e){return n(this,D).addEventListener(t,e),this}off(t,e){return n(this,D).removeEventListener(t,e),this}async wait(t,e=()=>!0){return new Promise(s=>{const i=(...o)=>{e(...o)&&(n(this,D).removeEventListener(t,i),s(o))};n(this,D).addEventListener(t,i)})}emit(t,e){n(this,D).dispatchEvent(t,e)}}D=new WeakMap;var I,j;class me extends ct{constructor(e){super();h(this,I);h(this,j,Number.MIN_SAFE_INTEGER);r(this,I,e),n(this,I).socket.on("bounced",s=>{var i;if((i=s.tags)!=null&&i.includes("DeathLink")&&s.data.time&&s.data.source){const o=s.data;if(o.time===n(this,j))return;r(this,j,o.time),this.emit("deathReceived",[o.source,o.time*1e3,o.cause])}})}get enabled(){return n(this,I).arguments.tags.includes("DeathLink")}enableDeathLink(){n(this,I).arguments.tags.includes("DeathLink")||n(this,I).updateTags([...n(this,I).arguments.tags,"DeathLink"])}disableDeathLink(){n(this,I).arguments.tags.includes("DeathLink")&&n(this,I).updateTags(n(this,I).arguments.tags.filter(e=>e!=="DeathLink"))}sendDeathLink(e,s){if(!n(this,I).authenticated)throw new R("Cannot send death links before connecting and authenticating.");if(!this.enabled)return;r(this,j,Math.ceil(Date.now()/1e3));const i={source:e,cause:s,time:n(this,j)};n(this,I).bounce({tags:["DeathLink"]},i)}}I=new WeakMap,j=new WeakMap;var $,tt,gt;class Mt{constructor(t,e){h(this,$);h(this,tt);h(this,gt);r(this,$,t),r(this,tt,e),r(this,gt,new J(n(this,$),{item:e.item,location:e.location,player:e.finding_player,flags:e.item_flags},n(this,$).players.findPlayer(e.finding_player),n(this,$).players.findPlayer(e.receiving_player)))}get item(){return n(this,gt)}get found(){return n(this,tt).found}get entrance(){return n(this,tt).entrance||"Vanilla"}}$=new WeakMap,tt=new WeakMap,gt=new WeakMap;var S,F,k,xt,Vt;class ge extends ct{constructor(e){super();h(this,xt);h(this,S);h(this,F,[]);h(this,k,[]);r(this,S,e),n(this,S).socket.on("receivedItems",s=>{let i=s.index;const o=s.items.length,c=[...s.items];for(;c.length>0;){const l=c.shift();n(this,F)[i++]=new J(n(this,S),l,n(this,S).players.findPlayer(l.player),n(this,S).players.self)}this.emit("itemsReceived",[n(this,F).slice(s.index,s.index+o),s.index])}).on("connected",()=>{r(this,k,[]),r(this,F,[]),n(this,S).storage.notify([`_read_hints_${n(this,S).players.self.team}_${n(this,S).players.self.slot}`],N(this,xt,Vt).bind(this)).then(s=>{const i=s[`_read_hints_${n(this,S).players.self.team}_${n(this,S).players.self.slot}`];r(this,k,i.map(o=>new Mt(n(this,S),o))),this.emit("hintsInitialized",[n(this,k)])}).catch(s=>{throw s})})}get received(){return[...n(this,F)]}get hints(){return[...n(this,k)]}get count(){return n(this,F).length}}S=new WeakMap,F=new WeakMap,k=new WeakMap,xt=new WeakSet,Vt=function(e,s){for(let i=0;i<s.length;i++)n(this,k)[i]===void 0?(n(this,k)[i]=new Mt(n(this,S),s[i]),this.emit("hintReceived",[n(this,k)[i]])):n(this,k)[i].found!==s[i].found&&(n(this,k)[i]=new Mt(n(this,S),s[i]),this.emit("hintFound",[n(this,k)[i]]))};class Ct{constructor(t,e){u(this,"client");u(this,"part");this.client=t,this.part=e}toString(){return this.text}}class pe extends Ct{constructor(e,s,i,o){super(e,s);u(this,"part");u(this,"type","item");u(this,"item");const c=e.players.findPlayer(s.player,o.team);this.part=s,this.item=new J(e,i,c,o)}get text(){return this.item.name}}var et;class fe extends Ct{constructor(e,s){super(e,s);h(this,et);u(this,"part");u(this,"type","location");u(this,"id");const i=e.players.findPlayer(s.player),o=e.package.findPackage(i.game);this.part=s,s.type==="location_name"?(r(this,et,s.text),this.id=o.locationTable[s.text]):(this.id=parseInt(s.text),r(this,et,e.package.lookupLocationName(i.game,this.id,!0)))}get text(){return n(this,et)}}et=new WeakMap;class _e extends Ct{constructor(e,s){super(e,s);u(this,"part");u(this,"type","color");u(this,"color");this.part=s,this.color=s.color}get text(){return this.part.text}}class ye extends Ct{constructor(e,s){super(e,s);u(this,"part");u(this,"type");this.part=s,this.part.type==="entrance_name"?this.type="entrance":this.type="text"}get text(){return this.part.text}}class Se extends Ct{constructor(e,s){super(e,s);u(this,"part");u(this,"type","player");u(this,"player");if(this.part=s,s.type==="player_id")this.player=e.players.findPlayer(parseInt(s.text));else{const i=e.players.teams[e.players.self.team].find(o=>o.name===s.text);if(!i)throw new Error(`Cannot find player under name: ${s.text}`);this.player=i}}get text(){return this.player.alias}}var g,Rt,Bt,Jt;class we extends ct{constructor(e){super();h(this,Bt);h(this,g);h(this,Rt,[]);r(this,g,e),n(this,g).socket.on("printJSON",N(this,Bt,Jt).bind(this))}get log(){return[...n(this,Rt)]}async say(e){if(!n(this,g).authenticated)throw new R("Cannot send chat messages without being authenticated.");e=e.trim();const s={cmd:"Say",text:e};n(this,g).socket.send(s),await this.wait("chat",i=>i===e)}}g=new WeakMap,Rt=new WeakMap,Bt=new WeakSet,Jt=function(e){const s=[];for(const o of e.data)switch(o.type){case"item_id":case"item_name":{const c=e;let l;c.type==="ItemCheat"?l=n(this,g).players.findPlayer(c.receiving,c.team):l=n(this,g).players.findPlayer(c.receiving),s.push(new pe(n(this,g),o,c.item,l));break}case"location_id":case"location_name":{s.push(new fe(n(this,g),o));break}case"color":{s.push(new _e(n(this,g),o));break}case"player_id":case"player_name":{s.push(new Se(n(this,g),o));break}default:{s.push(new ye(n(this,g),o));break}}const i=s.map(o=>o.text).join();switch(n(this,g).options.maximumMessages>=1&&(this.log.push({text:i,nodes:s}),this.log.splice(0,this.log.length-n(this,g).options.maximumMessages)),e.type){case"ItemSend":{const o=n(this,g).players.findPlayer(e.item.player),c=n(this,g).players.findPlayer(e.receiving),l=new J(n(this,g),e.item,o,c);this.emit("itemSent",[i,l,s]);break}case"ItemCheat":{const o=n(this,g).players.findPlayer(e.item.player,e.team),c=n(this,g).players.findPlayer(e.receiving,e.team),l=new J(n(this,g),e.item,o,c);this.emit("itemCheated",[i,l,s]);break}case"Hint":{const o=n(this,g).players.findPlayer(e.item.player),c=n(this,g).players.findPlayer(e.receiving),l=new J(n(this,g),e.item,o,c);this.emit("itemHinted",[i,l,e.found,s]);break}case"Join":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("connected",[i,o,e.tags,s]);break}case"Part":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("disconnected",[i,o,s]);break}case"Chat":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("chat",[e.message,o,s]);break}case"ServerChat":{this.emit("serverChat",[e.message,s]);break}case"TagsChanged":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("tagsUpdated",[i,o,e.tags,s]);break}case"Tutorial":{this.emit("tutorial",[i,s]);break}case"CommandResult":{this.emit("userCommand",[i,s]);break}case"AdminCommandResult":{this.emit("adminCommand",[i,s]);break}case"Goal":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("goaled",[i,o,s]);break}case"Release":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("released",[i,o,s]);break}case"Collect":{const o=n(this,g).players.findPlayer(e.slot,e.team);this.emit("collected",[i,o,s]);break}case"Countdown":this.emit("countdown",[i,e.countdown,s])}this.emit("message",[i,s])};var b,A,st,Tt;class Lt{constructor(t,e){h(this,st);h(this,b);h(this,A);r(this,b,t),r(this,A,e)}toString(){return this.alias}get name(){return n(this,A).name}get alias(){return n(this,A).alias}get game(){return this.slot===0?"Archipelago":n(this,st,Tt).game}get type(){return this.slot===0?Et.spectator:n(this,st,Tt).type}get team(){return n(this,A).team}get slot(){return n(this,A).slot}get members(){return this.type!==Et.group?[]:n(this,b).players.teams[this.team].filter(t=>n(this,st,Tt).group_members.includes(t.slot))}get groups(){return this.slot===0?[]:n(this,b).players.teams[this.team].filter(t=>t.slot!==0&&n(this,b).players.slots[t.slot].group_members.includes(this.slot))}async fetchStatus(){return this.type===Et.group?Ut.goal:await n(this,b).storage.fetch(`_read_client_status_${this.team}_${this.slot}`)??0}async fetchSlotData(){return await n(this,b).storage.fetch(`_read_slot_data_${this.slot}`)}async fetchHints(){return(await n(this,b).storage.fetch(`_read_hints_${this.team}_${this.slot}`)).map(e=>new Mt(n(this,b),e))}}b=new WeakMap,A=new WeakMap,st=new WeakSet,Tt=function(){return n(this,b).players.slots[this.slot]};var E,v,pt,it,ft;class ve extends ct{constructor(e){super();h(this,E);h(this,v,[]);h(this,pt,{});h(this,it,0);h(this,ft,0);r(this,E,e),n(this,E).socket.on("connected",s=>{var i,o;r(this,pt,Object.freeze(s.slot_info)),r(this,v,[]),r(this,it,s.slot),r(this,ft,s.team);for(const c of s.players)(i=n(this,v))[o=c.team]??(i[o]=[{team:c.team,slot:0,name:"Archipelago",alias:"Archipelago"}]),n(this,v)[c.team][c.slot]=c}).on("roomUpdate",s=>{if(s.players){for(const i of s.players)if(n(this,v)[i.team][i.slot].alias!==i.alias){const o=n(this,v)[i.team][i.slot].alias;n(this,v)[i.team][i.slot]=i,this.emit("aliasUpdated",[new Lt(n(this,E),i),o,i.alias])}}})}get self(){if(n(this,it)===0)throw new Error("Cannot lookup own player object when client has never connected to a server.");return new Lt(n(this,E),n(this,v)[n(this,ft)][n(this,it)])}get slots(){return n(this,pt)}get teams(){const e=[];for(let s=0;s<n(this,v).length;s++){e[s]=[];for(let i=0;i<n(this,v)[s].length;i++)e[s].push(new Lt(n(this,E),n(this,v)[s][i]))}return e}findPlayer(e,s){if(s===void 0&&(s=n(this,E).players.self.team),n(this,v)[s])return new Lt(n(this,E),n(this,v)[s][e])}}E=new WeakMap,v=new WeakMap,pt=new WeakMap,it=new WeakMap,ft=new WeakMap;var _t,yt,St,wt,vt,It,nt,W,ot,G,K,V,U,Dt;class Ie extends ct{constructor(e){super();h(this,_t);h(this,yt,{major:-1,minor:-1,build:-1});h(this,St,{major:-1,minor:-1,build:-1});h(this,wt,[]);h(this,vt,[]);h(this,It,"");h(this,nt,!1);h(this,W,0);h(this,ot,0);h(this,G,0);h(this,K,{release:0,collect:0,remaining:0});h(this,V,[]);h(this,U,[]);h(this,Dt,!1);r(this,_t,e),n(this,_t).socket.on("roomInfo",s=>{r(this,yt,{major:s.version.major,minor:s.version.minor,build:s.version.build}),r(this,St,{major:s.generator_version.major,minor:s.generator_version.minor,build:s.generator_version.build}),r(this,vt,s.tags),r(this,wt,s.games),r(this,It,s.seed_name),r(this,nt,s.password),r(this,K,s.permissions),r(this,ot,s.hint_cost),r(this,G,s.location_check_points)}).on("connected",s=>{r(this,V,s.missing_locations),r(this,U,s.checked_locations),this.emit("locationsChecked",[this.checkedLocations]),r(this,W,s.hint_points),this.emit("hintPointsUpdated",[0,s.hint_points])}).on("roomUpdate",s=>{if(s.hint_cost!==void 0){const[i,o]=[this.hintCost,this.hintCostPercentage];r(this,ot,s.hint_cost),this.emit("hintCostUpdated",[i,this.hintCost,o,this.hintCostPercentage])}if(s.hint_points!==void 0){const i=n(this,W);r(this,W,s.hint_points),this.emit("hintPointsUpdated",[i,this.hintPoints])}if(s.location_check_points!==void 0){const i=n(this,G);r(this,G,s.location_check_points),this.emit("locationCheckPointsUpdated",[i,this.locationCheckPoints])}if(s.password!==void 0&&(r(this,nt,s.password),this.emit("passwordUpdated",[this.password])),s.permissions!==void 0){const i=n(this,K);r(this,K,s.permissions),this.emit("permissionsUpdated",[i,this.permissions])}s.checked_locations!==void 0&&(r(this,U,[...n(this,U),...s.checked_locations]),r(this,V,this.missingLocations.filter(i=>{var o;return!((o=s.checked_locations)!=null&&o.includes(i))})),this.emit("locationsChecked",[s.checked_locations]))})}get serverVersion(){return{...n(this,yt)}}get generatorVersion(){return{...n(this,St)}}get games(){return[...n(this,wt)]}get tags(){return[...n(this,vt)]}get seedName(){return n(this,It)}get password(){return n(this,nt)}get permissions(){return{...n(this,K)}}get hintPoints(){return n(this,W)}get hintCost(){return this.hintCostPercentage>0?Math.max(1,Math.floor(this.hintCostPercentage*this.allLocations.length*.01)):0}get hintCostPercentage(){return n(this,ot)}get locationCheckPoints(){return n(this,G)}get missingLocations(){return[...n(this,V)].sort()}get checkedLocations(){return[...n(this,U)].sort()}get allLocations(){return[...n(this,V),...n(this,U)].sort()}get race(){return n(this,Dt)}}_t=new WeakMap,yt=new WeakMap,St=new WeakMap,wt=new WeakMap,vt=new WeakMap,It=new WeakMap,nt=new WeakMap,W=new WeakMap,ot=new WeakMap,G=new WeakMap,K=new WeakMap,V=new WeakMap,U=new WeakMap,Dt=new WeakMap;var w,at,ht,Yt,Zt;class ke extends ct{constructor(){super();h(this,ht);h(this,w,null);h(this,at,!1)}get connected(){return n(this,at)}get url(){var e;return((e=n(this,w))==null?void 0:e.url)??""}send(...e){if(n(this,w))return n(this,w).send(JSON.stringify(e)),this.emit("sentPackets",[e]),this;throw new Y("Unable to send packets to the server; not connected to a server.")}async connect(e){if(this.disconnect(),typeof e=="string"){if(!/^([a-zA-Z]+:)\/\/[A-Za-z0-9_.~\-:]+/i.test(e))try{return await this.connect(new URL(`wss://${e}`))}catch{return await this.connect(new URL(`ws://${e}`))}e=new URL(e)}if(e.port=e.port||"38281",e.protocol!=="wss:"&&e.protocol!=="ws:")throw new TypeError("Unexpected protocol. Archipelago only supports the ws:// and wss:// protocols.");try{return new Promise((s,i)=>{const o=N(this,ht,Zt).call(this);if(o===null)throw new Y("Unable to find a suitable WebSocket API in the current runtime.");r(this,w,new o(e)),n(this,w).onmessage=N(this,ht,Yt).bind(this),n(this,w).onclose=()=>{this.disconnect(),i(new Y("Failed to connect to Archipelago server."))},n(this,w).onerror=()=>{this.disconnect(),i(new Y("Failed to connect to Archipelago server."))},n(this,w).onopen=()=>{this.wait("roomInfo").then(([c])=>{if(r(this,at,!0),n(this,w)){n(this,w).onclose=this.disconnect.bind(this),n(this,w).onerror=this.disconnect.bind(this),s(c);return}this.disconnect(),i(new Y("Failed to connect to Archipelago server."))}).catch(c=>{throw c})}})}catch(s){throw this.disconnect(),s}}disconnect(){var e;this.connected&&(r(this,at,!1),(e=n(this,w))==null||e.close(),r(this,w,null),this.emit("disconnected",[]))}}w=new WeakMap,at=new WeakMap,ht=new WeakSet,Yt=function(e){const s=JSON.parse(e.data);for(const i of s){switch(i.cmd){case"ConnectionRefused":this.emit("connectionRefused",[i]);break;case"Bounced":this.emit("bounced",[i,i.data]);break;case"Connected":this.emit("connected",[i]);break;case"DataPackage":this.emit("dataPackage",[i]);break;case"InvalidPacket":this.emit("invalidPacket",[i]);break;case"LocationInfo":this.emit("locationInfo",[i]);break;case"PrintJSON":this.emit("printJSON",[i]);break;case"ReceivedItems":this.emit("receivedItems",[i]);break;case"Retrieved":this.emit("retrieved",[i]);break;case"RoomInfo":this.emit("roomInfo",[i]);break;case"RoomUpdate":this.emit("roomUpdate",[i]);break;case"SetReply":this.emit("setReply",[i]);break}this.emit("receivedPacket",[i])}},Zt=function(){let e=null;return typeof window<"u"?e=window.WebSocket||window.MozWebSocket:typeof global<"u"?e=global.WebSocket||global.MozWebSocket:typeof self<"u"?e=self.WebSocket||self.MozWebSocket:typeof WebSocket<"u"?e=WebSocket:typeof MozWebSocket<"u"&&(e=MozWebSocket),e};var rt,P,kt,bt;class be{constructor(t){h(this,rt,!1);h(this,P,At);h(this,kt,"");h(this,bt,"");u(this,"socket",new ke);u(this,"package",new ce(this));u(this,"storage",new de(this));u(this,"room",new Ie(this));u(this,"players",new ve(this));u(this,"items",new ge(this));u(this,"messages",new we(this));u(this,"deathLink",new me(this));u(this,"options");t?this.options={...jt,...t}:this.options={...jt},this.socket.on("disconnected",()=>{r(this,rt,!1)}).on("sentPackets",e=>{for(const s of e)s.cmd==="ConnectUpdate"&&(n(this,P).tags=s.tags,n(this,P).items=s.items_handling)})}get authenticated(){return this.socket.connected&&n(this,rt)}get name(){return n(this,kt)}get game(){return n(this,bt)}get arguments(){return{...n(this,P)}}async login(t,e,s="",i){if(e==="")throw new oe("Provided slot name cannot be blank.","name",e);i?r(this,P,{...At,...i}):r(this,P,{...At});const o=new Set(this.arguments.tags);!s&&!o.has("HintGame")&&!o.has("Tracker")&&!o.has("TextOnly")&&o.add("TextOnly"),n(this,P).tags=Array.from(o);const c={cmd:"Connect",name:e,game:s,password:this.arguments.password,slot_data:this.arguments.slotData,items_handling:this.arguments.items,uuid:this.arguments.uuid,tags:this.arguments.tags,version:{...this.arguments.version,class:"Version"}};return await this.socket.connect(t),this.options.autoFetchDataPackage&&await this.package.fetchPackage(),new Promise((l,d)=>{const m=setTimeout(()=>d(new Y("Server failed to respond in time.")),this.options.timeout),y=f=>{r(this,rt,!0),r(this,bt,f.slot_info[f.slot].game),r(this,kt,f.slot_info[f.slot].name),this.socket.off("connected",y).off("connectionRefused",p),clearTimeout(m),l(f.slot_data)},p=f=>{var O;this.socket.off("connected",y).off("connectionRefused",p),clearTimeout(m),d(new ae(`Connection was refused by the server. Reason(s): [${(O=f.errors)==null?void 0:O.join(", ")}`,f.errors??[]))};this.socket.on("connected",y.bind(this)).on("connectionRefused",p.bind(this)).send(c)})}updateStatus(t){if(!this.authenticated)throw new R("Cannot update status while not connected and authenticated.");this.socket.send({cmd:"StatusUpdate",status:t})}goal(){this.updateStatus(Ut.goal)}updateTags(t){if(!this.authenticated)throw new R("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:t,items_handling:this.arguments.items})}updateItemsHandling(t){if(!this.authenticated)throw new R("Cannot update tags while not connected and authenticated.");this.socket.send({cmd:"ConnectUpdate",tags:this.arguments.tags,items_handling:t})}check(...t){if(!this.authenticated)throw new R("Cannot check locations while not connected and authenticated.");t=t.filter(e=>this.room.missingLocations.includes(e)),this.socket.send({cmd:"LocationChecks",locations:t})}async scout(t,e=0){if(!this.authenticated)throw new R("Cannot scout locations while not connected and authenticated.");t=t.filter(i=>this.room.allLocations.includes(i));const[s]=await this.socket.send({cmd:"LocationScouts",create_as_hint:e,locations:t}).wait("locationInfo",i=>i.locations.map(o=>o.location).toSorted().join(",")===t.toSorted().join(","));return s.locations.map(i=>new J(this,i,this.players.self,this.players.findPlayer(i.player)))}bounce(t,e){if(!this.authenticated)throw new R("Cannot send bounces while not connected and authenticated.");this.socket.send({cmd:"Bounce",data:e,games:t.games??[],slots:t.slots??[],tags:t.tags??[]})}}rt=new WeakMap,P=new WeakMap,kt=new WeakMap,bt=new WeakMap;function Qt(){return new Promise((a,t)=>{const e=indexedDB.open("StickRangerAP",1);e.onupgradeneeded=()=>e.result.createObjectStore("savegames"),e.onsuccess=()=>a(e.result),e.onerror=()=>t(e.error)})}async function Wt(a){const t=await Qt();return new Promise((e,s)=>{const o=t.transaction("savegames","readonly").objectStore("savegames").get(a);o.onsuccess=()=>e(o.result),o.onerror=()=>s(o.error)})}async function Ce(a,t){const e=await Qt();return new Promise((s,i)=>{const o=e.transaction("savegames","readwrite");o.objectStore("savegames").put(t,a),o.oncomplete=()=>s(),o.onerror=()=>i(o.error)})}class Le{constructor(){this.STAGE_COMPLETE_OFFSET=1e4,this.BOOK_OFFSET=10100,this.LOC_OFFSET=11e3,this.ITEM_OFFSET=12e3,this.TRAPS_OFFSET=13e3,this.INV_START=16,this.MOUSE_SLOT=40,this.STAGE_TO_WIN=88,this._pendingConnect=!1,this._connected=!1,this.receivedItems=[],this.pendingItems=[],this.prevStage=[...Stage_Status],this.winReported=!1,this.lastSequence=-1,this.storageKey="",this.sendShopHints=!1,this.isScouting=!1,this.excludedBookStages=[0,20,47,70,77],this.bookHints={},this.randomizedBookCosts={},this.slotData={},this.deathLinkSent=!1,this.deathLinkReceived=!1,this.deathLinkPending=!1,this.deathLinkSource="",this.deathLinkTime="",this.deathLinkCause="",this.clickedDisconnect=!1,this.newGame=!1,this.pendingTraps=[],this.deathMouseItem={},this.connectMouseItem={},this.host=document.getElementById("host"),this.port=document.getElementById("port"),this.slotName=document.getElementById("slotName"),this.password=document.getElementById("password"),this.connect=document.getElementById("connect"),this.connectionBox=document.getElementById("connectionBox"),this.connectionInfo=document.getElementById("connectionInfo"),this.disconnect=document.getElementById("disconnect"),this.chatLine=document.getElementById("chatLine"),this.message=document.getElementById("message"),this.send=document.getElementById("send"),this.chatMessages=document.getElementById("chatMessages"),this.apDiv=document.getElementById("APConnection"),this.connect.addEventListener("click",()=>this._onConnectClick());const t=e=>{e.addEventListener("keydown",s=>{s.key==="Enter"&&this._onConnectClick()})};t(this.host),t(this.port),t(this.slotName),t(this.password),this.disconnect.addEventListener("click",()=>this._onDisconnectClick()),this.send.addEventListener("click",()=>this._onSendClick()),this.message.addEventListener("keydown",e=>{e.key==="Enter"&&this._onSendClick()}),window.addEventListener("beforeunload",()=>this._onUnload()),this._tick=this._tick.bind(this),requestAnimationFrame(this._tick)}async _onConnectClick(){if(this.connectionInfo.textContent="Connected at: "+this.host.value+":"+this.port.value+" - "+this.slotName.value,!this.clickedDisconnect){this.storageKey=[this.host.value,this.port.value,"Stick Ranger",this.slotName.value].join(":");const t=await Wt(this.storageKey);t&&(this.receivedItems=t.receivedItems,this.bookHints=t.bookHints??{},this.randomizedBookCosts=t.randomizedBookCosts??{},this.deathMouseItem=t.deathMouseItem??{},this.connectMouseItem=t.connectMouseItem??{},GameLoad(t.save.replace(/\r\n|\r|\n/g,"")))}this.clickedDisconnect=!1,this._pendingConnect=!0,this.apDiv.style.display="none",this.connectionBox.style.display="flex",this.log("Waiting for the game to enter the map...","info")}async _onDisconnectClick(){var t;this.clickedDisconnect=!0,await this.saveState(),this._pendingConnect=!1,this._connected=!1,this.apDiv.style.display="flex",this.connectionBox.style.display="none",this.chatLine.style.display="none",this.log("Disconnected from multiworld server.","info"),(t=this.client)==null||t.socket.disconnect()}_onSendClick(){const t=this.message.value.trim();t.length!==0&&(this.client.messages.say(t),t[0]==="/"&&this.log("Cannot issue command "+t.slice(1).split(" ")[0]+". Client commands are not yet supported."),this.message.value="")}log(t,e="info"){const s=document.createElement("div"),i=document.createElement("span");i.textContent=t,e==="error"&&(i.style.color="red"),s.appendChild(i),s.style.lineHeight="16px",this.chatMessages.append(s),this.chatMessages.scrollTop=this.chatMessages.scrollHeight}async saveState(){this.storageKey&&(Save_Code3=genSaveCode(0),await Ce(this.storageKey,{receivedItems:this.receivedItems,stages:Stage_Status,save:GameSave("0"),bookHints:this.bookHints??{},randomizedBookCosts:this.randomizedBookCosts??{},deathMouseItem:this.deathMouseItem??{},connectMouseItem:this.connectMouseItem??{}}))}_onUnload(){var t;(t=this.client)==null||t.socket.disconnect()}restoreStagesBeaten(t){for(let e=0;e<t.length;e++)Stage_Status[e]|=t[e];return antiCheatSet(),Stage_Status}createRandomizedBookCosts(t){const e={},s=Stage_Status.length;switch(t){case 1:{for(let i=0;i<s;i++){const o=100*i,c=4e3*i,l=Math.pow(Math.random(),1.5),d=o+l*(c-o);e[i]=Math.max(1,Math.floor(d))}return e}case 2:{for(let i=0;i<s;i++)e[i]=Math.floor(Math.random()*99999)+1;return e}case 3:{for(let i=0;i<s;i++)e[i]=Math.floor(Math.random()*999999)+1;return e}case 0:default:return{}}}isEmpty(t){for(const e in t)if(Object.hasOwn(t,e))return!1;return!0}die(t,e){this.log(`You died from ${t}'s death${e?`: ${e}`:""}.`,"error");for(let s=0;s<4;s++)LP_Current[s]=0;this.deathLinkSource="",this.deathLinkTime="",this.deathLinkCause="",antiCheatSet()}async _connect(){var l;this.client=new be;const t=this.host.value,e=parseInt(this.port.value),s="Stick Ranger",i=this.slotName.value,o=this.password.value,c=`${t}:${e}`;this.storageKey=[t,e,s,i].join(":"),this.client.socket.on("receivedItems",async d=>{const m=d.items.map(p=>p.item),y=d.index===0&&d.items.length>1&&this.receivedItems.length>0;for(const p of m)await this._applyItem(p,!1);if(y){const p=[...m];for(const f of this.receivedItems){const O=p.indexOf(f);O!==-1&&p.splice(O,1)}for(const f of p)f>=this.TRAPS_OFFSET||d.items[0].flags===4?await this._applyTrap(f):await this._applyItem(f,!0)}else for(const p of m)p>=this.TRAPS_OFFSET||d.items[0].flags===4?await this._applyTrap(p):await this._applyItem(p,!0)}),this.client.socket.on("locationInfo",d=>{d.locations.forEach(m=>{if(m.location>=this.BOOK_OFFSET&&m.location<this.BOOK_OFFSET+100){const y=m.location-this.BOOK_OFFSET;this.bookHints[y]={player:this.client.players.findPlayer(m.player).name,item:this.client.package.lookupItemName(this.client.players.findPlayer(m.player).game,m.item),itemClassification:m.flags}}})}),this.client.socket.on("printJSON",d=>{const m=document.createElement("div");if(d.item){const y=d.item.player;d.data.forEach(p=>{var O;const f=document.createElement("span");if(p.type==="player_id"){const zt=Number(p.text);f.textContent=(O=this.client.players.findPlayer(zt))==null?void 0:O.name,zt===y?f.style.color="#ee00ee":f.style.color="#eee8cd"}else if(p.type==="item_id")switch(f.textContent=this.client.package.lookupItemName(this.client.players.findPlayer(p.player).game,Number(p.text)),d.item.flags){case 1:f.style.color="#9f79ee";break;case 2:f.style.color="#4f94cd";break;case 4:f.style.color="#ed7b6e";break;case 0:default:f.style.color="#09cbcb";break}else p.type==="location_id"?(f.textContent=this.client.package.lookupLocationName(this.client.players.findPlayer(p.player).game,Number(p.text)),f.style.color="limegreen"):p.text&&(f.textContent=p.text);m.appendChild(f)})}else if(d.type==="CommandResult"){const y=document.createElement("pre");y.textContent=d.data[0].text,y.style.margin=0,m.appendChild(y)}else{const y=document.createElement("span");y.textContent=d.data[0].text,m.appendChild(y)}m.style.lineHeight="16px",this.chatMessages.appendChild(m),this.chatMessages.scrollTop=this.chatMessages.scrollHeight}),this.client.deathLink.on("deathReceived",(d,m,y)=>{this.deathLinkReceived=!0,this.deathLinkPending=!0,this.deathLinkSource=d,this.deathLinkTime=m,this.deathLinkCause=y}),this.client.socket.on("disconnected",()=>{console.warn("Disconnected from Archipelago")}),this.client.socket.on("connectionRefused",d=>{d.errors.forEach(m=>{this.log(m+"; please verify your connection settings.","error")})});try{const d=await Wt(this.storageKey);d?(this.receivedItems=d.receivedItems,Stage_Status=this.restoreStagesBeaten(d.stages)):await this.saveState(),this.slotData=await this.client.login(c,i,s,{password:o,itemsHandlingFlags:Nt.all,tags:["AP"],slotData:!0}),this._connected=!0,window.ArchipelagoMod.goldMultiplier=this.slotData.gold_multiplier??1,window.ArchipelagoMod.xpMultiplier=this.slotData.xp_multiplier??1,window.ArchipelagoMod.dropMultiplier=this.slotData.drop_multiplier??1,this.sendShopHints=this.slotData.shop_hints??!1,window.ArchipelagoMod.bookHintSpoiler=this.bookHints??{};const m=this.slotData.randomize_book_costs??0;window.ArchipelagoMod.bookCostRandomizer=m,this.isEmpty(this.randomizedBookCosts)&&(this.randomizedBookCosts=this.createRandomizedBookCosts(m)),window.ArchipelagoMod.randomizedBookCosts=this.randomizedBookCosts??{},this.slotData.death_link&&(this.client.deathLink.enableDeathLink(),this.client.updateTags(["AP","DeathLink"])),Item_Inv[this.MOUSE_SLOT]&&(this.connectMouseItem={itemId:Item_Inv[this.MOUSE_SLOT],compo1:Comp1_Inv[this.MOUSE_SLOT],compo2:Comp2_Inv[this.MOUSE_SLOT]},Item_Inv[this.MOUSE_SLOT]=0,Comp1_Inv[this.MOUSE_SLOT]=0,Comp2_Inv[this.MOUSE_SLOT]=0,antiCheatSet(),await this.saveState(),this.log("Storing mouse item ("+Item_Catalogue[this.connectMouseItem.itemId][0]+") to be recovered when in-game again.","info")),this.chatLine.style.display="flex",antiCheatSet()}catch(d){Array.isArray(d)&&((l=d[0])==null?void 0:l.target)instanceof WebSocket?this.log("Cannot connect to: "+d[0].target.url+" Please check the hostname and port, or the server's online status.","error"):this.log("Unknown error during connection: "+d,"error"),this._connected=!1,Sequence_Step=0,this.apDiv.style.display="flex",this.connectionBox.style.display="none",this.chatLine.style.display="none"}}async sendLocation(t){this.client.check(t),await this.saveState()}async _applyItem(t,e){if(t>=this.LOC_OFFSET&&t<this.LOC_OFFSET+999)Stage_Status[t-this.LOC_OFFSET]|=Unlocked,antiCheatSet();else if(t>=this.ITEM_OFFSET&&t<this.ITEM_OFFSET+999&&e){const s=t-this.ITEM_OFFSET,i=this._firstEmptyInvSlot();i>=0?(this.receivedItems.push(t),Item_Inv[i]=s,antiCheatSet()):this.pendingItems.push(t)}await this.saveState()}isInPlayableSequenceStep(){return[12,52,53,54,55].includes(Sequence_Step)}async _applyTrap(t){if(this.isInPlayableSequenceStep())switch(this.receivedItems.push(t),t){case 13e3:this.unequipItems();break;case 13001:this.loseHalfGold();break;case 13002:this.killRanger();break;case 13003:this.freezeRangers();break;case 13004:this.spawnEnemies();break}else this.pendingTraps.push(t);await this.saveState(),antiCheatSet()}unequipItems(){const t=[4,5,6,7].filter(l=>Item_Inv[l]);if(t.length===0)return;const e=l=>{for(let d=l.length-1;d>0;d--){const m=Math.floor(Math.random()*(d+1));[l[d],l[m]]=[l[m],l[d]]}return l},s=(l,d)=>{const m=Item_Inv[l],y=Comp1_Inv[l],p=Comp2_Inv[l];Item_Inv[d]=m,Comp1_Inv[d]=y,Comp2_Inv[d]=p,Item_Inv[l]=0,Comp1_Inv[l]=0,Comp2_Inv[l]=0,antiCheatSet()},i=()=>{if(t.length>0&&Item_Inv[this.MOUSE_SLOT]===0){const l=t.shift();s(l,this.MOUSE_SLOT),MP_Bar[l]=0,Players.PL_gladr_resid_count[l]=0,antiCheatSet()}},o=[];for(let l=this.INV_START;l<Item_Inv.length;l++)l!==this.MOUSE_SLOT&&!Item_Inv[l]&&o.push(l);e(t),e(o),o.length<4&&Item_Inv[this.MOUSE_SLOT]===0&&i();const c=Math.min(o.length,t.length);for(let l=0;l<c;l++){const d=t.shift();s(d,o[l]),MP_Bar[d]=0,Players.PL_gladr_resid_count[d]=0,antiCheatSet()}}loseHalfGold(){const t=Math.floor(Team_Gold/2);Team_Gold-=t,this.log("You lost $"+t+"!","error"),Indicators.INadd(Players.PL_joint[Selected_Player][0].x,Players.PL_joint[Selected_Player][0].y,0,"-$"+t,16727871),antiCheatSet()}killRanger(){const t=[0,1,2,3].filter(s=>LP_Current[s]>0);if(t.length===0)return;const e=t[Math.floor(Math.random()*t.length)];LP_Current[e]=0,antiCheatSet()}freezeRangers(){for(let t=0;t<Stickmen_Slots;t++){const e=Math.floor(Math.random()*750)+1;Players.PL_frozen_ticks[t]=e,antiCheatSet()}}spawnEnemies(){const t=new Set([40,115,163,244,333,334,335,336,337]),e=this.randomRangeInt(3,10);for(let s=0;s<e;s++){let i;do i=this.randomRangeInt(1,338);while(t.has(i));const o=Math.floor(Math.random()*((Win_Width>>3)-4-12+1))+12,c=fiftyfifty(Terrain.TR_low_surface[o],Terrain.TR_high_surface[o]);Enemies.ENadd(o,c,i)}}_firstEmptyInvSlot(){for(let t=this.INV_START;t<Item_Inv.length;t++)if(t!==this.MOUSE_SLOT&&!Item_Inv[t])return t;return-1}async _flushPending(){let t;for(;this.pendingItems.length&&(t=this._firstEmptyInvSlot())>=0;){const e=this.pendingItems.shift();this.receivedItems.push(e);const s=e-this.ITEM_OFFSET;Item_Inv[t]=s,antiCheatSet(),await this.saveState()}}async scoutBooksOnShopOpen(){for(let t=0;t<Stage_Status.length;t++)this.excludedBookStages.includes(t)||Stage_Status[t]===3&&!this.bookHints[t]&&this.client.scout([this.BOOK_OFFSET+t],2);await this.saveState()}_tick(){this._doTickWork().catch(t=>{console.error("Tick error:",t)}),requestAnimationFrame(this._tick)}async _doTickWork(){var t,e,s;if(this._connected){for(let i=0;i<Stage_Status.length;i++)(this.prevStage[i]&Beaten)===0&&(Stage_Status[i]&Beaten)!==0&&await this.sendLocation(i+this.STAGE_COMPLETE_OFFSET),(this.prevStage[i]&Booked)===0&&(Stage_Status[i]&Booked)!==0&&await this.sendLocation(i+10100);if(this.prevStage=[...Stage_Status],await this._flushPending(),this.isInPlayableSequenceStep()&&this.pendingTraps.length!==0)for(;this.pendingTraps.length>0;)this._applyTrap(this.pendingTraps.shift());if(!this.winReported&&(Stage_Status[this.STAGE_TO_WIN]&Beaten)===Beaten&&(this.winReported=!0,(t=this.client)==null||t.goal()),this.client.deathLink.enabled&&(Sequence_Step>=11&&Sequence_Step<=13&&this.deathLinkPending&&(this.deathLinkPending=!1,this.die(this.deathLinkSource,this.deathLinkCause)),Sequence_Step===30&&!this.deathLinkSent&&!this.deathLinkReceived&&(this.log("DeathLink: Sending death to your friends..."),this.deathLinkSent=!0,this.client.deathLink.sendDeathLink(this.slotData.player_name,this.slotData.player_name+" was defeated in Stick Ranger.")),Sequence_Step<6&&(this.deathLinkSent=!1,this.deathLinkReceived=!1,this.deathLinkPending=!1)),Sequence_Step===30&&(Item_Inv[this.MOUSE_SLOT]&&(this.deathMouseItem={itemId:Item_Inv[this.MOUSE_SLOT],compo1:Comp1_Inv[this.MOUSE_SLOT],compo2:Comp2_Inv[this.MOUSE_SLOT]},Item_Inv[this.MOUSE_SLOT]=0,Comp1_Inv[this.MOUSE_SLOT]=0,Comp2_Inv[this.MOUSE_SLOT]=0,antiCheatSet(),await this.saveState(),this.log("Storing mouse item ("+Item_Catalogue[this.deathMouseItem.itemId][0]+") to be recovered when in-game again.","info")),this.pendingTraps=[]),this.isInPlayableSequenceStep()&&((e=this.deathMouseItem)==null?void 0:e.itemId)>0){const i=this._firstEmptyInvSlot();i!==-1&&(Item_Inv[i]=this.deathMouseItem.itemId,Comp1_Inv[i]=this.deathMouseItem.compo1,Comp2_Inv[i]=this.deathMouseItem.compo2,this.deathMouseItem={},antiCheatSet(),await this.saveState(),this.log("Mouse item ("+Item_Catalogue[Item_Inv[i]][0]+") recovered into inventory.","info"))}if(this.isInPlayableSequenceStep()&&((s=this.connectMouseItem)==null?void 0:s.itemId)>0){const i=this._firstEmptyInvSlot();i!==-1&&(Item_Inv[i]=this.connectMouseItem.itemId,Comp1_Inv[i]=this.connectMouseItem.compo1,Comp2_Inv[i]=this.connectMouseItem.compo2,this.connectMouseItem={},antiCheatSet(),await this.saveState(),this.log("Mouse item ("+Item_Catalogue[Item_Inv[i]][0]+") recovered into inventory.","info"))}Sequence_Step===54&&!this.isScouting&&this.sendShopHints&&(this.isScouting=!0,this.scoutBooksOnShopOpen()),Sequence_Step!==54&&this.isScouting&&(this.isScouting=!1),this.newGame&&(this.newGame=!1,this.receivedItems=[])}Sequence_Step===6&&this.lastSequence===4&&(this.newGame=!0),Sequence_Step>=6&&this._pendingConnect&&!this._connected&&(this._pendingConnect=!1,this._connect()),this.lastSequence=Sequence_Step}randomRangeInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}}window.ap=new Le;
